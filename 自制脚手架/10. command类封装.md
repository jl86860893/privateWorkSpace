## 新建Command类实现init流程

![](C:/Users/YC01705/Desktop/脚手架架构学习/pic/脚手架设计/架构优化.jpg)

图中右侧command constructor中封装命令的处理流程

> lerna create @ijianglu/command models/command
>
> 并安装semver和colors;将检查Node版本移至此处

```js
'use strict';

const log = require('@ijianglu/log')
const colors = require('colors/safe');
const semver = require('semver');

class Command {
    constructor(argv) {
        this._argv = argv;
        console.log(argv)
        // 创建微任务队列，并检查node版本
        let runner = new Promise((resolve, reject) => {
            let chain = Promise.resolve();
            chain = chain.then(() => this.checkNodeVersion())
            chain.catch(e => {log.error(e.message)})
        })
    }

    checkNodeVersion() {
        const currentVersion = process.version;
        if (!semver.gte(currentVersion, '12.0.0')) {
            throw new Error(colors.red(`cli-dev 需要安装 v12.0.0 以上版本的 Node.js`))
        }
    }

    init() {
        throw new Error('init必须实现')
    }

    exec() {
        throw new Error('exec必须实现')
    }
}

module.exports = Command;
```

## 创建InitCommand类继承Command类

```js
'use strict';

const Command = require('@ijianglu/command')

class InitCommand extends Command {

}

// 此处形参与commander注册命令的action参数一致
function init(argv) {
    // console.log('init', projectName, cmdObj.force, cmdObj.parent.targetPath)
    return new InitCommand(argv);
}

module.exports = init;
module.exports.InitCommand = InitCommand;
```

